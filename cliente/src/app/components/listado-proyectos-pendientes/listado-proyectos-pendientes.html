<app-encabezado></app-encabezado>

<div class="container-fluid">
  <div class="row flex-nowrap">

    <div class="col-md-2 bg-light min-vh-100 p-3 sidebar">
      <app-navbar></app-navbar>
    </div>

    <div class="col py-3">

      <h2 class="mb-4 text-primary fw-bold">Proyectos con entregas pendientes</h2>

      <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
        <strong>¡Error!</strong> {{ errorMessage }}
      </div>

      <div *ngIf="!cargando && proyectosPendientes.length > 0" class="accordion" id="accordionProyectosPendientes">

        <div *ngFor="let proyecto of proyectosPendientes; let i = index"
          class="accordion-item mb-3 shadow-sm border-0 rounded-3">

          <h2 class="accordion-header" [id]="'heading' + i">
            <button class="accordion-button collapsed fw-semibold d-flex align-items-center" type="button"
              data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + i" aria-expanded="false"
              [attr.aria-controls]="'collapse' + i">

              <div class="d-flex justify-content-between align-items-center w-100 pe-3">

                <div>
                  <span class="text-secondary fw-normal me-2"><i class="bi bi-journal-bookmark-fill me-1"></i>{{
                    proyecto.claseNombre }}</span>
                  <span class="text-secondary mx-2">|</span>
                  <span class="fw-bold text-dark">{{ proyecto.nombre }}</span>
                </div>

                <div class="d-flex flex-column align-items-end">
                  <span class="badge rounded-pill px-3 py-2"
                    [ngClass]="haVencido(proyecto.fechaEntrega) ? 'text-bg-danger' : 'text-bg-primary'">
                    <i class="bi bi-calendar-event me-1"></i>
                    {{ proyecto.fechaEntrega | date:'dd/MM/yyyy' }}
                  </span>
                  <small *ngIf="haVencido(proyecto.fechaEntrega)" class="text-danger fw-bold mt-1"
                    style="font-size: 0.75rem;">
                    ¡Vencido!
                  </small>
                </div>

              </div>
            </button>
          </h2>

          <div [id]="'collapse' + i" class="accordion-collapse collapse" [attr.aria-labelledby]="'heading' + i"
            data-bs-parent="#accordionProyectosPendientes">
            <div class="accordion-body bg-light">

              <div class="row">
                <div class="col-md-9">
                  <p class="mb-2">
                    <i class="bi bi-person-workspace text-primary me-2"></i>
                    <strong>Profesor:</strong> {{ proyecto.profesorNombre }}
                  </p>

                  <p class="mb-2">
                    <i class="bi bi-tags text-primary me-2"></i>
                    <strong>Tipo:</strong> {{ proyecto.tipoProyectoNombre }}
                  </p>

                  <div class="mt-3 p-3 bg-white rounded border">
                    <strong class="d-block mb-2 text-secondary">Descripción:</strong>
                    {{ proyecto.descripcion }}
                  </div>
                </div>

                <div class="col-md-3 d-flex align-items-end justify-content-end">
                  <button class="btn btn-primary w-100 mt-3 mt-md-0" (click)="irAClase(proyecto.claseId)">
                    <i class="bi bi-box-arrow-in-right me-2"></i> Ir a la Clase
                  </button>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!cargando && proyectosPendientes.length === 0 && !errorMessage"
        class="text-center p-5 bg-white shadow-sm rounded-4 mt-4 border border-success border-opacity-25">
        <i class="bi bi-check-circle-fill text-success display-1 mb-3"></i>
        <h4 class="fw-bold text-success">¡Todo al día!</h4>
        <p class="text-muted mb-0">No tenés entregas pendientes por el momento.</p>
      </div>

      <div *ngIf="cargando" class="text-center mt-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2 text-muted">Buscando tareas pendientes...</p>
      </div>

    </div>
  </div>
</div>